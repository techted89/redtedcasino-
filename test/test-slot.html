<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Machine Test Harness</title>
    <style>
        body { font-family: sans-serif; display: flex; background-color: #1a1a1a; color: white; }
        .game-container { flex: 2; padding: 20px; }
        .controls-container { flex: 1; padding: 20px; background-color: #2c2c2c; height: 100vh; overflow-y: auto; }
        h1, h2 { text-align: center; }
        .reel { display: inline-block; width: 100px; height: 100px; margin: 0 10px; border: 2px solid gold; background-size: contain; }
        .bottom-bar { display: flex; justify-content: space-around; align-items: center; padding: 20px; background-color: rgba(0,0,0,0.7); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #555; }
        input[type="number"] { width: 60px; }
        textarea { width: 100%; height: 200px; margin-top: 10px; }
        button { background-color: #d42a2a; color: white; border: none; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div class="game-container">
    <h1>Slot Machine Test</h1>
    <div class="reels-container" style="text-align: center;">
        <div class="reel" id="reel1"></div>
        <div class="reel" id="reel2"></div>
        <div class="reel" id="reel3"></div>
        <div class="reel" id="reel4"></div>
        <div class="reel" id="reel5"></div>
    </div>
    <div class="bottom-bar">
        <div>Bet: <input type="number" id="bet-amount" value="10"></div>
        <button id="spin-button">SPIN</button>
        <div>Balance: <span id="balance-display">1000</span></div>
    </div>
    <div style="text-align: center; font-size: 24px; color: #ffd700; margin-top: 20px;" id="winnings-display"></div>
</div>

<div class="controls-container">
    <h2>Paytable Editor</h2>
    <form id="paytable-form">
        <div id="paytable-editor"></div>
        <button type="button" id="export-button">Export Paytable as JSON</button>
    </form>
    <textarea id="json-output" readonly></textarea>
</div>

<script>
// --- MOCK DATA AND CONFIG ---
const MOCK_GAME_CONFIG = {
    symbols: {
        S1: 'http://redtedcasino.com/BearSlot/img/symbol1.png',
        S2: 'http://redtedcasino.com/BearSlot/img/symbol2.png',
        S3: 'http://redtedcasino.com/BearSlot/img/symbol3.png',
        S4: 'http://redtedcasino.com/BearSlot/img/symbol4.png',
        S5: 'http://redtedcasino.com/BearSlot/img/symbol5.png',
        WILD: 'http://redtedcasino.com/BearSlot/img/symbol_wild.png',
        JACKPOT: 'http://redtedcasino.com/BearSlot/img/symbol_jackpot.png'
    },
    paytable: {
        'S1': { '3': 50, '4': 100, '5': 200 },
        'S2': { '3': 40, '4': 80, '5': 160 },
        'S3': { '3': 30, '4': 60, '5': 120 },
        'S4': { '3': 20, '4': 40, '5': 80 },
        'S5': { '3': 10, '4': 20, '5': 40 },
        'JACKPOT': { '3': 500, '4': 1000, '5': 5000 }
    }
};

let mockUserBalance = 1000;

// --- MOCK SERVER LOGIC ---
function mockSpin(betAmount, gameConfig) {
    mockUserBalance -= betAmount;

    // Generate Spin
    const symbolKeys = Object.keys(gameConfig.symbols);
    const spinResultKeys = Array.from({ length: 5 }, () => symbolKeys[Math.floor(Math.random() * symbolKeys.length)]);

    // Calculate Winnings
    let winnings = 0;
    const line = spinResultKeys;
    const paytable = gameConfig.paytable;
    for (const symbol in paytable) {
        let count = 0;
        for (let i = 0; i < line.length; i++) {
            if (line[i] === symbol || (line[i] === 'WILD' && symbol !== 'JACKPOT')) count++;
            else break;
        }
        if (paytable[symbol] && paytable[symbol][count]) {
            winnings = Math.max(winnings, paytable[symbol][count] * betAmount);
        }
    }

    mockUserBalance += winnings;

    // Format response like the real API
    return Promise.resolve({
        reels: spinResultKeys.map(key => gameConfig.symbols[key]),
        winnings: winnings,
        newBalance: mockUserBalance
    });
}

// --- DOM ELEMENTS ---
const balanceDisplay = document.getElementById('balance-display');
const spinButton = document.getElementById('spin-button');
const winningsDisplay = document.getElementById('winnings-display');
const reels = Array.from({length: 5}, (_, i) => document.getElementById(`reel${i + 1}`));
const paytableEditor = document.getElementById('paytable-editor');
const exportButton = document.getElementById('export-button');
const jsonOutput = document.getElementById('json-output');

// --- PAYTABLE EDITOR LOGIC ---
function renderPaytableEditor() {
    let tableHTML = '<table><thead><tr><th>Symbol</th><th>3</th><th>4</th><th>5</th></tr></thead><tbody>';
    for (const symbolKey in MOCK_GAME_CONFIG.symbols) {
        const payouts = MOCK_GAME_CONFIG.paytable[symbolKey] || {};
        tableHTML += `<tr>
            <td>${symbolKey}</td>
            <td><input type="number" class="paytable-input" data-symbol="${symbolKey}" data-count="3" value="${payouts['3'] || 0}"></td>
            <td><input type="number" class="paytable-input" data-symbol="${symbolKey}" data-count="4" value="${payouts['4'] || 0}"></td>
            <td><input type="number" class="paytable-input" data-symbol="${symbolKey}" data-count="5" value="${payouts['5'] || 0}"></td>
        </tr>`;
    }
    tableHTML += '</tbody></table>';
    paytableEditor.innerHTML = tableHTML;
}

paytableEditor.addEventListener('input', (e) => {
    if (e.target.classList.contains('paytable-input')) {
        const symbol = e.target.dataset.symbol;
        const count = e.target.dataset.count;
        const value = parseInt(e.target.value, 10);

        if (!MOCK_GAME_CONFIG.paytable[symbol]) {
            MOCK_GAME_CONFIG.paytable[symbol] = {};
        }
        MOCK_GAME_CONFIG.paytable[symbol][count] = value;
    }
});

exportButton.addEventListener('click', () => {
    const jsonString = JSON.stringify(MOCK_GAME_CONFIG.paytable, null, 2);
    jsonOutput.value = jsonString;
});

// --- GAME LOGIC ---
spinButton.addEventListener('click', async () => {
    const betAmount = parseInt(document.getElementById('bet-amount').value, 10);
    if (betAmount > mockUserBalance) {
        alert('Insufficient balance.');
        return;
    }

    spinButton.disabled = true;
    winningsDisplay.textContent = 'Spinning...';

    const data = await mockSpin(betAmount, MOCK_GAME_CONFIG);

    // Update UI
    balanceDisplay.textContent = data.newBalance;
    data.reels.forEach((symbolUrl, i) => {
        reels[i].style.backgroundImage = `url('${symbolUrl}')`;
    });
    winningsDisplay.textContent = data.winnings > 0 ? `YOU WON: ${data.winnings}!` : ' ';

    spinButton.disabled = false;
});

// --- INITIALIZE ---
renderPaytableEditor();

</script>
</body>
</html>
