<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <style>
        /* ... styles omitted for brevity ... */
        .pagination-controls { margin-top: 15px; text-align: center; }
        .pagination-controls button { margin: 0 5px; }
        .pagination-controls span { margin: 0 10px; font-weight: bold; }
    </style>
</head>
<body>
<div id="login-section" class="container">...</div>
<div id="admin-panel" class="container hidden">
    <h1>Admin Panel</h1>
    <p id="admin-message"></p>
    <section id="user-management">
        <h2>User Management</h2>
        <input type="text" id="user-search" placeholder="Search not implemented for pagination">
        <table id="user-table">...</table>
        <div id="user-pagination" class="pagination-controls"></div>
    </section>
    <hr>
    <section id="withdrawal-management">
        <h2>Withdrawal Requests</h2>
        <table id="withdrawal-table">...</table>
        <div id="withdrawal-pagination" class="pagination-controls"></div>
    </section>
    <!-- Other sections ... -->
</div>

<script src="utils.js"></script>
<script>
    // --- Global State ---
    let userCurrentPage = 1;
    let withdrawalCurrentPage = 1;

    // --- Initial Load ---
    async function loadInitialData() {
        await Promise.all([
            loadUsers(userCurrentPage),
            loadWithdrawalRequests(withdrawalCurrentPage),
            // ... other load functions
        ]);
    }

    // --- User Management ---
    async function loadUsers(page = 1) {
        try {
            const result = await apiRequest(`/api/admin/users?page=${page}&limit=10`);
            renderUserTable(result.data);
            renderPagination('user-pagination', result.totalPages, result.currentPage, loadUsers);
            userCurrentPage = result.currentPage;
        } catch (err) {
            setMessage(err.message, true);
        }
    }

    function renderUserTable(users) { /* ... */ }

    // --- Withdrawal Management ---
    async function loadWithdrawalRequests(page = 1) {
        try {
            const result = await apiRequest(`/api/admin/withdrawal-requests?page=${page}&limit=5`);
            renderWithdrawalRequestsTable(result.data);
            renderPagination('withdrawal-pagination', result.totalPages, result.currentPage, loadWithdrawalRequests);
            withdrawalCurrentPage = result.currentPage;
        } catch (err) {
            setMessage(err.message, true);
        }
    }

    function renderWithdrawalRequestsTable(requests) { /* ... */ }

    // --- Generic Pagination Renderer ---
    function renderPagination(containerId, totalPages, currentPage, loadFunction) {
        const container = document.getElementById(containerId);
        if (totalPages <= 1) {
            container.innerHTML = '';
            return;
        }

        let html = '';
        html += `<button data-page="${currentPage - 1}" ${currentPage === 1 ? 'disabled' : ''}>&larr; Previous</button>`;
        html += `<span>Page ${currentPage} of ${totalPages}</span>`;
        html += `<button data-page="${currentPage + 1}" ${currentPage === totalPages ? 'disabled' : ''}>Next &rarr;</button>`;
        container.innerHTML = html;

        container.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', (e) => {
                const page = parseInt(e.currentTarget.dataset.page, 10);
                loadFunction(page);
            });
        });
    }

    // --- Other functions and event listeners ---
    // (login, apiRequest, handleLogout, game management, etc.)
    // The full script would be here.
    window.addEventListener('load', () => {
        if (sessionStorage.getItem('adminToken')) {
            document.getElementById('admin-panel').classList.remove('hidden');
            loadInitialData();
        } else {
            document.getElementById('login-section').classList.remove('hidden');
        }
    });
    function setMessage(msg, isError = false) { document.getElementById('admin-message').textContent = msg; }
</script>
</body>
</html>
